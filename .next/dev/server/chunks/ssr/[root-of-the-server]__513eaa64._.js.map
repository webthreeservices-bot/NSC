{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Desktop/nsc-test/vercel-download/src/store/authStore.ts"],"sourcesContent":["import { create } from 'zustand'\nimport { persist } from 'zustand/middleware'\n\ninterface User {\n  id: string\n  email: string\n  username: string\n  fullName: string | null\n  referralCode: string\n  isAdmin: boolean\n  isEmailVerified: boolean\n  twoFactorEnabled: boolean\n}\n\ninterface AuthState {\n  user: User | null\n  setUser: (user: User) => void\n  clearUser: () => void\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set) => ({\n      user: null,\n      setUser: (user) => set({ user }),\n      clearUser: () => set({ user: null }),\n    }),\n    {\n      name: 'auth-storage',\n    }\n  )\n)\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAmBO,MAAM,eAAe,IAAA,kKAAM,IAChC,IAAA,wJAAO,EACL,CAAC,MAAQ,CAAC;QACR,MAAM;QACN,SAAS,CAAC,OAAS,IAAI;gBAAE;YAAK;QAC9B,WAAW,IAAM,IAAI;gBAAE,MAAM;YAAK;IACpC,CAAC,GACD;IACE,MAAM;AACR"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Desktop/nsc-test/vercel-download/src/lib/api.ts"],"sourcesContent":["// Use relative URL to avoid CORS issues - always use same origin\nconst API_URL = '/api'\n\ninterface RequestOptions extends RequestInit {\n  token?: string\n}\n\nasync function apiRequest<T = any>(\n  endpoint: string,\n  options: RequestOptions = {}\n): Promise<T> {\n  const { token, ...fetchOptions } = options\n\n  const headers: HeadersInit = {\n    'Content-Type': 'application/json',\n    ...fetchOptions.headers,\n  }\n\n  if (token) {\n    headers['Authorization'] = `Bearer ${token}`\n  }\n\n  // Retry logic for network errors (especially useful for mobile)\n  const maxRetries = 2\n  let lastError: any = null\n\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    try {\n      const controller = new AbortController()\n      const timeoutId = setTimeout(() => controller.abort(), 30000) // 30 second timeout\n\n      const response = await fetch(`${API_URL}${endpoint}`, {\n        ...fetchOptions,\n        headers,\n        signal: controller.signal,\n      })\n\n      clearTimeout(timeoutId)\n\n      // Parse response body\n      let data: any\n      try {\n        const text = await response.text()\n        data = text ? JSON.parse(text) : {}\n      } catch (parseError) {\n        console.error('Failed to parse response:', parseError)\n        data = { error: 'Invalid response from server' }\n      }\n\n      if (!response.ok) {\n        const errorDetails = {\n          endpoint,\n          status: response.status,\n          statusText: response.statusText,\n          data,\n          attempt: attempt + 1,\n          url: `${API_URL}${endpoint}`\n        }\n\n        // Only log if there's actual error information\n        if (errorDetails.status || errorDetails.data) {\n          console.error('API Error:', errorDetails)\n        }\n        \n        // Extract error message from response\n        let errorMessage = 'Request failed'\n        \n        if (data && typeof data === 'object') {\n          if (data.error && typeof data.error === 'string') {\n            errorMessage = data.error\n          } else if (data.message && typeof data.message === 'string') {\n            errorMessage = data.message\n          } else if (data.error && typeof data.error === 'object') {\n            errorMessage = JSON.stringify(data.error)\n          } else {\n            errorMessage = `Request failed with status ${response.status}`\n          }\n        } else if (typeof data === 'string') {\n          errorMessage = data\n        } else {\n          errorMessage = `Request failed with status ${response.status}`\n        }\n        \n        // Create an error with a clear message\n        const error = new Error(errorMessage)\n        ;(error as any).status = response.status\n        ;(error as any).data = data\n        throw error\n      }\n\n      return data\n    } catch (error: any) {\n      lastError = error\n      \n      // Check if it's a network error that we should retry\n      const isNetworkError = \n        error.name === 'AbortError' ||\n        error.message?.includes('fetch') ||\n        error.message?.includes('network') ||\n        error.message?.includes('timeout') ||\n        error.message?.includes('ETIMEDOUT') ||\n        error.message?.includes('ECONNREFUSED')\n\n      // Retry on network errors, but not on client errors (4xx) or application errors\n      if (isNetworkError && attempt < maxRetries) {\n        console.warn(`Network error, retrying (${attempt + 1}/${maxRetries})...`)\n        // Wait before retry with exponential backoff\n        await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000))\n        continue\n      }\n\n      // Don't retry, throw the error\n      console.error('API Request Error:', {\n        endpoint,\n        error: error.message || error,\n        stack: error.stack,\n        attempt: attempt + 1\n      })\n      \n      // If it's already an Error object with a message, re-throw it\n      if (error instanceof Error && error.message) {\n        throw error\n      }\n      \n      // Otherwise create a new Error with a proper message\n      throw new Error(error?.message || 'Network error. Please check your connection and try again.')\n    }\n  }\n\n  // If we get here, all retries failed\n  throw lastError || new Error('Request failed after retries')\n}\n\n// Auth API\nexport const authAPI = {\n  register: (data: { email: string; password: string; fullName: string; referralCode: string }) =>\n    apiRequest('/auth/register', { method: 'POST', body: JSON.stringify(data) }),\n\n  login: (data: { email: string; password: string; twoFactorCode?: string }) =>\n    apiRequest('/auth/login', { method: 'POST', body: JSON.stringify(data) }),\n\n  verifyEmail: (token: string) =>\n    apiRequest('/auth/verify-email', { method: 'POST', body: JSON.stringify({ token }) }),\n\n  forgotPassword: (email: string) =>\n    apiRequest('/auth/forgot-password', { method: 'POST', body: JSON.stringify({ email }) }),\n\n  resetPassword: (token: string, newPassword: string) =>\n    apiRequest('/auth/reset-password', { method: 'POST', body: JSON.stringify({ token, newPassword }) }),\n\n  enable2FA: (token: string) =>\n    apiRequest('/auth/enable-2fa', { method: 'POST', token }),\n\n  verify2FA: (code: string, token: string) =>\n    apiRequest('/auth/verify-2fa', { method: 'POST', body: JSON.stringify({ code }), token }),\n}\n\n// User API\nexport const userAPI = {\n  getProfile: (token: string) =>\n    apiRequest('/user/profile', { token }),\n\n  updateProfile: (data: any, token: string) =>\n    apiRequest('/user/profile', { method: 'PUT', body: JSON.stringify(data), token }),\n\n  getReferralCode: (token: string) =>\n    apiRequest('/user/referral-code', { token }),\n}\n\n// Package API\nexport const packageAPI = {\n  create: (data: { amount: number; network: string }, token: string) =>\n    apiRequest('/packages/create', { method: 'POST', body: JSON.stringify(data), token }),\n\n  getMyPackages: (params: any, token: string) => {\n    const query = new URLSearchParams(params).toString()\n    return apiRequest(`/packages/my-packages?${query}`, { token })\n  },\n\n  getPackageById: (id: string, token: string) =>\n    apiRequest(`/packages/${id}`, { token }),\n\n  verifyDeposit: (id: string, txHash: string, token: string) =>\n    apiRequest(`/packages/${id}/verify-deposit`, { method: 'POST', body: JSON.stringify({ txHash }), token }),\n}\n\n// Bot API\nexport const botAPI = {\n  activate: (data: { botType: string; network: string; txHash: string }, token: string) =>\n    apiRequest('/bots/activate', { method: 'POST', body: JSON.stringify(data), token }),\n\n  getMyBots: (token: string) =>\n    apiRequest('/bots/my-bots', { token }),\n\n  checkEligibility: (botType: string, token: string) =>\n    apiRequest(`/bots/check-eligibility?botType=${botType}`, { token }),\n}\n\n// Earnings API\nexport const earningsAPI = {\n  getSummary: (token: string) =>\n    apiRequest('/earnings/summary', { token }),\n\n  getHistory: (params: any, token: string) => {\n    const query = new URLSearchParams(params).toString()\n    return apiRequest(`/earnings/history?${query}`, { token })\n  },\n\n  getRoiSchedule: (token: string) =>\n    apiRequest('/earnings/roi-schedule', { token }),\n}\n\n// Referral API\nexport const referralAPI = {\n  getStats: (token: string) =>\n    apiRequest('/referrals/stats', { token }),\n\n  getTree: (level: number | undefined, token: string) => {\n    const query = level ? `?level=${level}` : ''\n    return apiRequest(`/referrals/tree${query}`, { token })\n  },\n\n  getDirect: (token: string) =>\n    apiRequest('/referrals/direct', { token }),\n\n  getLevelBreakdown: (token: string) =>\n    apiRequest('/referrals/level-breakdown', { token }),\n}\n\n// Withdrawal API\nexport const withdrawalAPI = {\n  request: (data: any, token: string) =>\n    apiRequest('/withdrawals/request', { method: 'POST', body: JSON.stringify(data), token }),\n\n  getHistory: (params: any, token: string) => {\n    const query = new URLSearchParams(params).toString()\n    return apiRequest(`/withdrawals/history?${query}`, { token })\n  },\n\n  checkEligibility: (token: string) =>\n    apiRequest('/withdrawals/check-eligibility', { token }),\n}\n\n// Transaction API\nexport const transactionAPI = {\n  getHistory: (params: any, token: string) => {\n    const query = new URLSearchParams(params).toString()\n    return apiRequest(`/transactions/history?${query}`, { token })\n  },\n\n  getById: (id: string, token: string) =>\n    apiRequest(`/transactions/${id}`, { token }),\n}\n\n// Admin API\nexport const adminAPI = {\n  // User Management\n  getUsers: (params: any, token: string) => {\n    const query = new URLSearchParams(params).toString()\n    return apiRequest(`/admin/users?${query}`, { token })\n  },\n\n  // Withdrawal Management\n  getPendingWithdrawals: (token: string) =>\n    apiRequest('/admin/withdrawals/pending', { token }),\n\n  approveWithdrawal: (id: string, token: string) =>\n    apiRequest(`/admin/withdrawals/${id}/approve`, { method: 'POST', body: JSON.stringify({}), token }),\n\n  rejectWithdrawal: (id: string, reason: string, token: string) =>\n    apiRequest(`/admin/withdrawals/${id}/reject`, { method: 'POST', body: JSON.stringify({ reason }), token }),\n\n  // Statistics\n  getStatistics: (token: string) =>\n    apiRequest('/admin/statistics', { token }),\n\n  // Bot Package Management\n  getBotPackages: (token: string) =>\n    apiRequest('/admin/bot-packages', { token }),\n\n  createBotPackage: (data: { name: string; type: string; price: number; roi: number; duration?: number; description?: string; isActive?: boolean }, token: string) =>\n    apiRequest('/admin/bot-packages', { method: 'POST', body: JSON.stringify(data), token }),\n\n  updateBotPackage: (id: string, data: { name?: string; type?: string; price?: number; roi?: number; duration?: number; description?: string; isActive?: boolean }, token: string) =>\n    apiRequest('/admin/bot-packages', { method: 'PUT', body: JSON.stringify({ id, ...data }), token }),\n\n  deleteBotPackage: (id: string, token: string) =>\n    apiRequest(`/admin/bot-packages?id=${id}`, { method: 'DELETE', token }),\n\n  // System Settings\n  updateSystemSettings: (data: { key: string; value: string }, token: string) =>\n    apiRequest('/admin/system-settings', { method: 'POST', body: JSON.stringify(data), token }),\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 368, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Desktop/nsc-test/vercel-download/src/utils/error-helpers.ts"],"sourcesContent":["/**\r\n * Extract a user-friendly error message from various error formats\r\n */\r\nexport function extractErrorMessage(err: any, defaultMessage: string = 'An error occurred'): string {\r\n  // Handle null/undefined\r\n  if (!err) {\r\n    return defaultMessage\r\n  }\r\n\r\n  // Handle Error instances\r\n  if (err instanceof Error) {\r\n    return err.message || defaultMessage\r\n  }\r\n\r\n  // Handle response objects from API errors\r\n  if (err.response?.data) {\r\n    const data = err.response.data\r\n    if (typeof data === 'string') {\r\n      return data\r\n    }\r\n    if (data.error && typeof data.error === 'string') {\r\n      return data.error\r\n    }\r\n    if (data.message && typeof data.message === 'string') {\r\n      return data.message\r\n    }\r\n  }\r\n\r\n  // Handle direct error property\r\n  if (err.error) {\r\n    if (typeof err.error === 'string') {\r\n      return err.error\r\n    }\r\n    if (err.error.message && typeof err.error.message === 'string') {\r\n      return err.error.message\r\n    }\r\n  }\r\n\r\n  // Handle direct message property\r\n  if (err.message && typeof err.message === 'string') {\r\n    return err.message\r\n  }\r\n\r\n  // Handle string errors\r\n  if (typeof err === 'string') {\r\n    return err\r\n  }\r\n\r\n  // Handle objects we couldn't parse\r\n  if (typeof err === 'object') {\r\n    try {\r\n      // Try to extract any string value\r\n      const keys = Object.keys(err)\r\n      for (const key of keys) {\r\n        if (typeof err[key] === 'string' && err[key].length > 0) {\r\n          return err[key]\r\n        }\r\n      }\r\n      \r\n      // If no string found, stringify the object (last resort)\r\n      const stringified = JSON.stringify(err)\r\n      if (stringified !== '{}' && stringified !== '[object Object]') {\r\n        return stringified\r\n      }\r\n    } catch (e) {\r\n      console.error('Error while extracting error message:', e)\r\n    }\r\n  }\r\n\r\n  // Fallback to default message\r\n  return defaultMessage\r\n}\r\n\r\n/**\r\n * Format error for logging\r\n */\r\nexport function formatErrorForLogging(err: any): Record<string, any> {\r\n  return {\r\n    type: typeof err,\r\n    constructor: err?.constructor?.name,\r\n    message: err?.message,\r\n    error: err?.error,\r\n    response: err?.response?.data,\r\n    status: err?.status || err?.response?.status,\r\n    stack: err?.stack,\r\n    raw: err\r\n  }\r\n}\r\n\r\n/**\r\n * Check if error is a specific type\r\n */\r\nexport function isNetworkError(err: any): boolean {\r\n  const message = extractErrorMessage(err, '').toLowerCase()\r\n  return message.includes('network') || \r\n         message.includes('fetch') || \r\n         message.includes('connection') ||\r\n         message.includes('timeout') ||\r\n         err?.name === 'NetworkError' ||\r\n         err?.code === 'NETWORK_ERROR'\r\n}\r\n\r\nexport function isAuthError(err: any): boolean {\r\n  const status = err?.status || err?.response?.status\r\n  return status === 401 || status === 403\r\n}\r\n\r\nexport function isValidationError(err: any): boolean {\r\n  const status = err?.status || err?.response?.status\r\n  return status === 400 || status === 422\r\n}\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;;;;;;;;;AACM,SAAS,oBAAoB,GAAQ,EAAE,iBAAyB,mBAAmB;IACxF,wBAAwB;IACxB,IAAI,CAAC,KAAK;QACR,OAAO;IACT;IAEA,yBAAyB;IACzB,IAAI,eAAe,OAAO;QACxB,OAAO,IAAI,OAAO,IAAI;IACxB;IAEA,0CAA0C;IAC1C,IAAI,IAAI,QAAQ,EAAE,MAAM;QACtB,MAAM,OAAO,IAAI,QAAQ,CAAC,IAAI;QAC9B,IAAI,OAAO,SAAS,UAAU;YAC5B,OAAO;QACT;QACA,IAAI,KAAK,KAAK,IAAI,OAAO,KAAK,KAAK,KAAK,UAAU;YAChD,OAAO,KAAK,KAAK;QACnB;QACA,IAAI,KAAK,OAAO,IAAI,OAAO,KAAK,OAAO,KAAK,UAAU;YACpD,OAAO,KAAK,OAAO;QACrB;IACF;IAEA,+BAA+B;IAC/B,IAAI,IAAI,KAAK,EAAE;QACb,IAAI,OAAO,IAAI,KAAK,KAAK,UAAU;YACjC,OAAO,IAAI,KAAK;QAClB;QACA,IAAI,IAAI,KAAK,CAAC,OAAO,IAAI,OAAO,IAAI,KAAK,CAAC,OAAO,KAAK,UAAU;YAC9D,OAAO,IAAI,KAAK,CAAC,OAAO;QAC1B;IACF;IAEA,iCAAiC;IACjC,IAAI,IAAI,OAAO,IAAI,OAAO,IAAI,OAAO,KAAK,UAAU;QAClD,OAAO,IAAI,OAAO;IACpB;IAEA,uBAAuB;IACvB,IAAI,OAAO,QAAQ,UAAU;QAC3B,OAAO;IACT;IAEA,mCAAmC;IACnC,IAAI,OAAO,QAAQ,UAAU;QAC3B,IAAI;YACF,kCAAkC;YAClC,MAAM,OAAO,OAAO,IAAI,CAAC;YACzB,KAAK,MAAM,OAAO,KAAM;gBACtB,IAAI,OAAO,GAAG,CAAC,IAAI,KAAK,YAAY,GAAG,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG;oBACvD,OAAO,GAAG,CAAC,IAAI;gBACjB;YACF;YAEA,yDAAyD;YACzD,MAAM,cAAc,KAAK,SAAS,CAAC;YACnC,IAAI,gBAAgB,QAAQ,gBAAgB,mBAAmB;gBAC7D,OAAO;YACT;QACF,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,yCAAyC;QACzD;IACF;IAEA,8BAA8B;IAC9B,OAAO;AACT;AAKO,SAAS,sBAAsB,GAAQ;IAC5C,OAAO;QACL,MAAM,OAAO;QACb,aAAa,KAAK,aAAa;QAC/B,SAAS,KAAK;QACd,OAAO,KAAK;QACZ,UAAU,KAAK,UAAU;QACzB,QAAQ,KAAK,UAAU,KAAK,UAAU;QACtC,OAAO,KAAK;QACZ,KAAK;IACP;AACF;AAKO,SAAS,eAAe,GAAQ;IACrC,MAAM,UAAU,oBAAoB,KAAK,IAAI,WAAW;IACxD,OAAO,QAAQ,QAAQ,CAAC,cACjB,QAAQ,QAAQ,CAAC,YACjB,QAAQ,QAAQ,CAAC,iBACjB,QAAQ,QAAQ,CAAC,cACjB,KAAK,SAAS,kBACd,KAAK,SAAS;AACvB;AAEO,SAAS,YAAY,GAAQ;IAClC,MAAM,SAAS,KAAK,UAAU,KAAK,UAAU;IAC7C,OAAO,WAAW,OAAO,WAAW;AACtC;AAEO,SAAS,kBAAkB,GAAQ;IACxC,MAAM,SAAS,KAAK,UAAU,KAAK,UAAU;IAC7C,OAAO,WAAW,OAAO,WAAW;AACtC"}},
    {"offset": {"line": 471, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Desktop/nsc-test/vercel-download/src/lib/mobile-utils.ts"],"sourcesContent":["/**\r\n * Mobile utility functions for better mobile experience\r\n */\r\n\r\n/**\r\n * Detect if user is on mobile device\r\n */\r\nexport function isMobileDevice(): boolean {\r\n  if (typeof window === 'undefined') return false\r\n  \r\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\r\n    navigator.userAgent\r\n  )\r\n}\r\n\r\n/**\r\n * Detect if user is on slow connection\r\n */\r\nexport function isSlowConnection(): boolean {\r\n  if (typeof navigator === 'undefined' || !('connection' in navigator)) {\r\n    return false\r\n  }\r\n  \r\n  const connection = (navigator as any).connection\r\n  \r\n  if (!connection) return false\r\n  \r\n  // Check effective type (slow-2g, 2g, 3g, 4g)\r\n  if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {\r\n    return true\r\n  }\r\n  \r\n  // Check if saveData is enabled (user opted for reduced data usage)\r\n  if (connection.saveData) {\r\n    return true\r\n  }\r\n  \r\n  return false\r\n}\r\n\r\n/**\r\n * Get recommended timeout based on connection\r\n */\r\nexport function getRecommendedTimeout(): number {\r\n  if (isSlowConnection()) {\r\n    return 60000 // 60 seconds for slow connections\r\n  }\r\n  \r\n  if (isMobileDevice()) {\r\n    return 30000 // 30 seconds for mobile\r\n  }\r\n  \r\n  return 15000 // 15 seconds for desktop\r\n}\r\n\r\n/**\r\n * Add retry logic for fetch requests on mobile\r\n */\r\nexport async function fetchWithRetry(\r\n  url: string,\r\n  options: RequestInit = {},\r\n  maxRetries: number = 2\r\n): Promise<Response> {\r\n  let lastError: any\r\n  \r\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\r\n    try {\r\n      const controller = new AbortController()\r\n      const timeout = getRecommendedTimeout()\r\n      const timeoutId = setTimeout(() => controller.abort(), timeout)\r\n      \r\n      const response = await fetch(url, {\r\n        ...options,\r\n        signal: controller.signal,\r\n      })\r\n      \r\n      clearTimeout(timeoutId)\r\n      return response\r\n    } catch (error: any) {\r\n      lastError = error\r\n      \r\n      // Check if it's a network error worth retrying\r\n      const shouldRetry =\r\n        error.name === 'AbortError' ||\r\n        error.message?.includes('fetch') ||\r\n        error.message?.includes('network') ||\r\n        error.message?.includes('timeout')\r\n      \r\n      if (shouldRetry && attempt < maxRetries) {\r\n        // Exponential backoff\r\n        const delay = Math.pow(2, attempt) * 1000\r\n        await new Promise(resolve => setTimeout(resolve, delay))\r\n        continue\r\n      }\r\n      \r\n      throw error\r\n    }\r\n  }\r\n  \r\n  throw lastError\r\n}\r\n\r\n/**\r\n * Show user-friendly error message based on error type\r\n */\r\nexport function getMobileFriendlyErrorMessage(error: any): string {\r\n  if (!error) return 'An error occurred. Please try again.'\r\n  \r\n  const message = error.message || error.error || String(error)\r\n  \r\n  // Network errors\r\n  if (message.includes('timeout') || message.includes('ETIMEDOUT')) {\r\n    return 'Connection timeout. Please check your internet and try again.'\r\n  }\r\n  \r\n  if (message.includes('network') || message.includes('fetch failed')) {\r\n    return 'Network error. Please check your connection and try again.'\r\n  }\r\n  \r\n  if (message.includes('ECONNREFUSED') || message.includes('connect')) {\r\n    return 'Cannot connect to server. Please try again later.'\r\n  }\r\n  \r\n  // Database errors\r\n  if (message.includes('database') || message.includes('Database')) {\r\n    return 'Service temporarily unavailable. Please try again in a moment.'\r\n  }\r\n  \r\n  // Auth errors\r\n  if (message.includes('Invalid email or password')) {\r\n    return 'Invalid email or password'\r\n  }\r\n  \r\n  if (message.includes('blocked')) {\r\n    return 'Your account has been blocked. Please contact support.'\r\n  }\r\n  \r\n  if (message.includes('2FA')) {\r\n    return message // Keep 2FA messages as-is\r\n  }\r\n  \r\n  // Rate limiting\r\n  if (message.includes('Too many')) {\r\n    return message // Keep rate limit messages as-is\r\n  }\r\n  \r\n  // Default\r\n  return message || 'An error occurred. Please try again.'\r\n}\r\n"],"names":[],"mappings":"AAAA;;CAEC,GAED;;CAEC;;;;;;;;;;;;AACM,SAAS;IACd,wCAAmC,OAAO;;;AAK5C;AAKO,SAAS;IACd,IAAI,OAAO,cAAc,eAAe,CAAC,CAAC,gBAAgB,SAAS,GAAG;QACpE,OAAO;IACT;IAEA,MAAM,aAAa,AAAC,UAAkB,UAAU;IAEhD,IAAI,CAAC,YAAY,OAAO;IAExB,6CAA6C;IAC7C,IAAI,WAAW,aAAa,KAAK,aAAa,WAAW,aAAa,KAAK,MAAM;QAC/E,OAAO;IACT;IAEA,mEAAmE;IACnE,IAAI,WAAW,QAAQ,EAAE;QACvB,OAAO;IACT;IAEA,OAAO;AACT;AAKO,SAAS;IACd,IAAI,oBAAoB;QACtB,OAAO,MAAM,kCAAkC;;IACjD;IAEA,IAAI,kBAAkB;QACpB,OAAO,MAAM,wBAAwB;;IACvC;IAEA,OAAO,MAAM,yBAAyB;;AACxC;AAKO,eAAe,eACpB,GAAW,EACX,UAAuB,CAAC,CAAC,EACzB,aAAqB,CAAC;IAEtB,IAAI;IAEJ,IAAK,IAAI,UAAU,GAAG,WAAW,YAAY,UAAW;QACtD,IAAI;YACF,MAAM,aAAa,IAAI;YACvB,MAAM,UAAU;YAChB,MAAM,YAAY,WAAW,IAAM,WAAW,KAAK,IAAI;YAEvD,MAAM,WAAW,MAAM,MAAM,KAAK;gBAChC,GAAG,OAAO;gBACV,QAAQ,WAAW,MAAM;YAC3B;YAEA,aAAa;YACb,OAAO;QACT,EAAE,OAAO,OAAY;YACnB,YAAY;YAEZ,+CAA+C;YAC/C,MAAM,cACJ,MAAM,IAAI,KAAK,gBACf,MAAM,OAAO,EAAE,SAAS,YACxB,MAAM,OAAO,EAAE,SAAS,cACxB,MAAM,OAAO,EAAE,SAAS;YAE1B,IAAI,eAAe,UAAU,YAAY;gBACvC,sBAAsB;gBACtB,MAAM,QAAQ,KAAK,GAAG,CAAC,GAAG,WAAW;gBACrC,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;gBACjD;YACF;YAEA,MAAM;QACR;IACF;IAEA,MAAM;AACR;AAKO,SAAS,8BAA8B,KAAU;IACtD,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,UAAU,MAAM,OAAO,IAAI,MAAM,KAAK,IAAI,OAAO;IAEvD,iBAAiB;IACjB,IAAI,QAAQ,QAAQ,CAAC,cAAc,QAAQ,QAAQ,CAAC,cAAc;QAChE,OAAO;IACT;IAEA,IAAI,QAAQ,QAAQ,CAAC,cAAc,QAAQ,QAAQ,CAAC,iBAAiB;QACnE,OAAO;IACT;IAEA,IAAI,QAAQ,QAAQ,CAAC,mBAAmB,QAAQ,QAAQ,CAAC,YAAY;QACnE,OAAO;IACT;IAEA,kBAAkB;IAClB,IAAI,QAAQ,QAAQ,CAAC,eAAe,QAAQ,QAAQ,CAAC,aAAa;QAChE,OAAO;IACT;IAEA,cAAc;IACd,IAAI,QAAQ,QAAQ,CAAC,8BAA8B;QACjD,OAAO;IACT;IAEA,IAAI,QAAQ,QAAQ,CAAC,YAAY;QAC/B,OAAO;IACT;IAEA,IAAI,QAAQ,QAAQ,CAAC,QAAQ;QAC3B,OAAO,QAAQ,0BAA0B;;IAC3C;IAEA,gBAAgB;IAChB,IAAI,QAAQ,QAAQ,CAAC,aAAa;QAChC,OAAO,QAAQ,iCAAiC;;IAClD;IAEA,UAAU;IACV,OAAO,WAAW;AACpB"}},
    {"offset": {"line": 588, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Desktop/nsc-test/vercel-download/src/hooks/useAuth.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react'\nimport { useAuthStore } from '@/store/authStore'\nimport { authAPI } from '@/lib/api'\nimport { getTokenFromStorage, setTokenToStorage, removeTokenFromStorage, setRefreshTokenToStorage } from '@/lib/auth'\nimport { extractErrorMessage, formatErrorForLogging } from '@/utils/error-helpers'\nimport { getMobileFriendlyErrorMessage } from '@/lib/mobile-utils'\n\nexport function useAuth() {\n  const { user, setUser, clearUser } = useAuthStore()\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [initializing, setInitializing] = useState(true)\n\n  // Validate current token on hook initialization\n  const validateToken = useCallback(async () => {\n    const token = getTokenFromStorage()\n    \n    if (!token) {\n      console.log('ðŸ” No token found, user not authenticated')\n      clearUser()\n      setInitializing(false)\n      return false\n    }\n\n    try {\n      console.log('ðŸ” Validating existing token...')\n      const response = await fetch('/api/auth/validate', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        credentials: 'include'\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        if (data.valid && data.user) {\n          console.log('âœ… Token valid, user authenticated:', data.user.email)\n          setUser({\n            id: data.user.id,\n            email: data.user.email,\n            username: data.user.email.split('@')[0], // Fallback username\n            fullName: data.user.fullName || null,\n            referralCode: data.user.referralCode || '',\n            isAdmin: data.user.isAdmin || false,\n            isEmailVerified: data.user.isEmailVerified || false,\n            twoFactorEnabled: data.user.twoFactorEnabled || false\n          })\n          setInitializing(false)\n          return true\n        }\n      }\n\n      console.log('âŒ Token invalid, clearing authentication')\n      removeTokenFromStorage()\n      clearUser()\n      setInitializing(false)\n      return false\n    } catch (error) {\n      console.error('âŒ Token validation error:', error)\n      removeTokenFromStorage()\n      clearUser()\n      setInitializing(false)\n      return false\n    }\n  }, [setUser, clearUser])\n\n  // Initialize auth state on mount\n  useEffect(() => {\n    validateToken()\n  }, [validateToken])\n\n  const login = useCallback(async (email: string, password: string, twoFactorCode?: string) => {\n    setLoading(true)\n    setError(null)\n    \n    try {\n      const response: any = await authAPI.login({ email, password, twoFactorCode })\n      \n      if (response?.success) {\n        if (response.token) {\n          // Store token in both localStorage and cookie\n          setTokenToStorage(response.token)\n          if (response.refreshToken) {\n            setRefreshTokenToStorage(response.refreshToken)\n          }\n        }\n        if (response.user) {\n          setUser(response.user)\n          // Store admin status\n          if (response.user.isAdmin) {\n            localStorage.setItem('adminToken', response.token)\n          }\n        }\n        return { success: true }\n      }\n      \n      // Handle 2FA requirement\n      if (response?.requires2FA) {\n        setError('Please enter your 2FA code')\n        return { success: false, error: '2FA code required' }\n      }\n      \n      setError('Login failed. Please try again.')\n      return { success: false, error: 'Login failed' }\n    } catch (err: any) {\n      console.error('Login error in useAuth:', formatErrorForLogging(err))\n      \n      // Use mobile-friendly error messages\n      const errorMessage = getMobileFriendlyErrorMessage(err)\n      \n      // Check for 2FA requirement\n      if (errorMessage.includes('2FA')) {\n        return { success: false, error: errorMessage }\n      }\n      \n      setError(errorMessage)\n      return { success: false, error: errorMessage }\n    } finally {\n      setLoading(false)\n    }\n  }, [setUser])\n\n  const register = useCallback(async (data: {\n    email: string\n    password: string\n    fullName: string\n    referralCode: string  // Now required, not optional\n  }) => {\n    setLoading(true)\n    setError(null)\n\n    try {\n      console.log('Registering with data:', data)\n      const response: any = await authAPI.register(data)\n      \n      if (response?.token) {\n        setTokenToStorage(response.token)\n        if (response.user) {\n          setUser(response.user)\n        }\n        return { success: true }\n      }\n      \n      return { success: false, error: response?.message || 'Registration failed' }\n    } catch (err: any) {\n      console.error('Registration error in useAuth:', formatErrorForLogging(err))\n      \n      // Use mobile-friendly error messages\n      const errorMessage = getMobileFriendlyErrorMessage(err)\n      \n      setError(errorMessage)\n      return { success: false, error: errorMessage }\n    } finally {\n      setLoading(false)\n    }\n  }, [setUser])\n\n  const logout = useCallback(async () => {\n    removeTokenFromStorage()\n    clearUser()\n    \n    // Clear cookies by calling logout API\n    try {\n      await fetch('/api/auth/logout', { method: 'POST' })\n    } catch (error) {\n      console.error('Logout error:', error)\n    }\n\n    // Redirect to home\n    window.location.href = '/'\n  }, [clearUser])\n\n  return {\n    user,\n    loading,\n    error,\n    initializing,\n    login,\n    register,\n    logout,\n    validateToken,\n    setUser,\n    isAuthenticated: !!user\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEO,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,IAAA,kIAAY;IACjD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAgB;IAClD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IAEjD,gDAAgD;IAChD,MAAM,gBAAgB,IAAA,oNAAW,EAAC;QAChC,MAAM,QAAQ,IAAA,kIAAmB;QAEjC,IAAI,CAAC,OAAO;YACV,QAAQ,GAAG,CAAC;YACZ;YACA,gBAAgB;YAChB,OAAO;QACT;QAEA,IAAI;YACF,QAAQ,GAAG,CAAC;YACZ,MAAM,WAAW,MAAM,MAAM,sBAAsB;gBACjD,QAAQ;gBACR,SAAS;oBACP,gBAAgB;oBAChB,iBAAiB,CAAC,OAAO,EAAE,OAAO;gBACpC;gBACA,aAAa;YACf;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,IAAI,KAAK,KAAK,IAAI,KAAK,IAAI,EAAE;oBAC3B,QAAQ,GAAG,CAAC,sCAAsC,KAAK,IAAI,CAAC,KAAK;oBACjE,QAAQ;wBACN,IAAI,KAAK,IAAI,CAAC,EAAE;wBAChB,OAAO,KAAK,IAAI,CAAC,KAAK;wBACtB,UAAU,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;wBACvC,UAAU,KAAK,IAAI,CAAC,QAAQ,IAAI;wBAChC,cAAc,KAAK,IAAI,CAAC,YAAY,IAAI;wBACxC,SAAS,KAAK,IAAI,CAAC,OAAO,IAAI;wBAC9B,iBAAiB,KAAK,IAAI,CAAC,eAAe,IAAI;wBAC9C,kBAAkB,KAAK,IAAI,CAAC,gBAAgB,IAAI;oBAClD;oBACA,gBAAgB;oBAChB,OAAO;gBACT;YACF;YAEA,QAAQ,GAAG,CAAC;YACZ,IAAA,qIAAsB;YACtB;YACA,gBAAgB;YAChB,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,IAAA,qIAAsB;YACtB;YACA,gBAAgB;YAChB,OAAO;QACT;IACF,GAAG;QAAC;QAAS;KAAU;IAEvB,iCAAiC;IACjC,IAAA,kNAAS,EAAC;QACR;IACF,GAAG;QAAC;KAAc;IAElB,MAAM,QAAQ,IAAA,oNAAW,EAAC,OAAO,OAAe,UAAkB;QAChE,WAAW;QACX,SAAS;QAET,IAAI;YACF,MAAM,WAAgB,MAAM,qHAAO,CAAC,KAAK,CAAC;gBAAE;gBAAO;gBAAU;YAAc;YAE3E,IAAI,UAAU,SAAS;gBACrB,IAAI,SAAS,KAAK,EAAE;oBAClB,8CAA8C;oBAC9C,IAAA,gIAAiB,EAAC,SAAS,KAAK;oBAChC,IAAI,SAAS,YAAY,EAAE;wBACzB,IAAA,uIAAwB,EAAC,SAAS,YAAY;oBAChD;gBACF;gBACA,IAAI,SAAS,IAAI,EAAE;oBACjB,QAAQ,SAAS,IAAI;oBACrB,qBAAqB;oBACrB,IAAI,SAAS,IAAI,CAAC,OAAO,EAAE;wBACzB,aAAa,OAAO,CAAC,cAAc,SAAS,KAAK;oBACnD;gBACF;gBACA,OAAO;oBAAE,SAAS;gBAAK;YACzB;YAEA,yBAAyB;YACzB,IAAI,UAAU,aAAa;gBACzB,SAAS;gBACT,OAAO;oBAAE,SAAS;oBAAO,OAAO;gBAAoB;YACtD;YAEA,SAAS;YACT,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAe;QACjD,EAAE,OAAO,KAAU;YACjB,QAAQ,KAAK,CAAC,2BAA2B,IAAA,kJAAqB,EAAC;YAE/D,qCAAqC;YACrC,MAAM,eAAe,IAAA,uJAA6B,EAAC;YAEnD,4BAA4B;YAC5B,IAAI,aAAa,QAAQ,CAAC,QAAQ;gBAChC,OAAO;oBAAE,SAAS;oBAAO,OAAO;gBAAa;YAC/C;YAEA,SAAS;YACT,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAa;QAC/C,SAAU;YACR,WAAW;QACb;IACF,GAAG;QAAC;KAAQ;IAEZ,MAAM,WAAW,IAAA,oNAAW,EAAC,OAAO;QAMlC,WAAW;QACX,SAAS;QAET,IAAI;YACF,QAAQ,GAAG,CAAC,0BAA0B;YACtC,MAAM,WAAgB,MAAM,qHAAO,CAAC,QAAQ,CAAC;YAE7C,IAAI,UAAU,OAAO;gBACnB,IAAA,gIAAiB,EAAC,SAAS,KAAK;gBAChC,IAAI,SAAS,IAAI,EAAE;oBACjB,QAAQ,SAAS,IAAI;gBACvB;gBACA,OAAO;oBAAE,SAAS;gBAAK;YACzB;YAEA,OAAO;gBAAE,SAAS;gBAAO,OAAO,UAAU,WAAW;YAAsB;QAC7E,EAAE,OAAO,KAAU;YACjB,QAAQ,KAAK,CAAC,kCAAkC,IAAA,kJAAqB,EAAC;YAEtE,qCAAqC;YACrC,MAAM,eAAe,IAAA,uJAA6B,EAAC;YAEnD,SAAS;YACT,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAa;QAC/C,SAAU;YACR,WAAW;QACb;IACF,GAAG;QAAC;KAAQ;IAEZ,MAAM,SAAS,IAAA,oNAAW,EAAC;QACzB,IAAA,qIAAsB;QACtB;QAEA,sCAAsC;QACtC,IAAI;YACF,MAAM,MAAM,oBAAoB;gBAAE,QAAQ;YAAO;QACnD,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iBAAiB;QACjC;QAEA,mBAAmB;QACnB,OAAO,QAAQ,CAAC,IAAI,GAAG;IACzB,GAAG;QAAC;KAAU;IAEd,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,iBAAiB,CAAC,CAAC;IACrB;AACF"}},
    {"offset": {"line": 798, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/LENOVO/Desktop/nsc-test/vercel-download/src/app/admin/layout.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport { useRouter, usePathname } from 'next/navigation'\r\nimport { useAuth } from '@/hooks/useAuth'\r\n\r\nexport default function AdminRootLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode\r\n}) {\r\n  const router = useRouter()\r\n  const pathname = usePathname()\r\n  const { user, isAuthenticated } = useAuth()\r\n  const [isAuthorized, setIsAuthorized] = useState(false)\r\n  const [isLoading, setIsLoading] = useState(true)\r\n  const [hydrated, setHydrated] = useState(false)\r\n\r\n  // Wait for Zustand store to hydrate\r\n  useEffect(() => {\r\n    setHydrated(true)\r\n  }, [])\r\n\r\n  // Pages that don't require authentication\r\n  const publicAdminPages = ['/admin/login']\r\n  const isPublicPage = publicAdminPages.includes(pathname)\r\n\r\n  useEffect(() => {\r\n    // Don't run auth check until store is hydrated\r\n    if (!hydrated) return\r\n\r\n    let isMounted = true\r\n\r\n    const checkAdminAccess = async () => {\r\n      if (!isMounted) return\r\n\r\n      setIsLoading(true)\r\n\r\n      // If it's a public admin page (like login), don't check authentication\r\n      if (isPublicPage) {\r\n        if (isMounted) {\r\n          setIsAuthorized(true)\r\n          setIsLoading(false)\r\n        }\r\n        return\r\n      }\r\n\r\n      // Check for token in localStorage\r\n      const token = typeof window !== 'undefined' ? localStorage.getItem('token') : null\r\n\r\n      if (!token) {\r\n        console.log('No token found, redirecting to admin login')\r\n        if (typeof window !== 'undefined') {\r\n          sessionStorage.setItem('adminRedirectAfterLogin', pathname)\r\n        }\r\n        router.push('/admin/login')\r\n        return\r\n      }\r\n\r\n      // Validate token with API\r\n      try {\r\n        const response = await fetch('/api/auth/validate', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`\r\n          },\r\n          credentials: 'include'\r\n        })\r\n\r\n        if (!isMounted) return\r\n\r\n        if (response.ok) {\r\n          const data = await response.json()\r\n\r\n          if (data.valid && data.user?.isAdmin) {\r\n            console.log('Admin access verified for user:', data.user.email)\r\n            if (isMounted) {\r\n              setIsAuthorized(true)\r\n              setIsLoading(false)\r\n            }\r\n            return\r\n          }\r\n        }\r\n\r\n        // Token invalid or not admin\r\n        console.log('Token invalid or user not admin, redirecting to admin login')\r\n        if (typeof window !== 'undefined') {\r\n          localStorage.removeItem('token')\r\n          localStorage.removeItem('refreshToken')\r\n          sessionStorage.setItem('adminRedirectAfterLogin', pathname)\r\n        }\r\n        router.push('/admin/login')\r\n      } catch (error) {\r\n        console.error('Admin auth check error:', error)\r\n        if (isMounted) {\r\n          router.push('/admin/login')\r\n        }\r\n      }\r\n    }\r\n\r\n    checkAdminAccess()\r\n\r\n    return () => {\r\n      isMounted = false\r\n    }\r\n  }, [hydrated, router, isPublicPage, pathname])\r\n\r\n  // Show loading state with better debugging\r\n  if (isLoading || !isAuthorized) {\r\n    return (\r\n      <div className=\"min-h-screen bg-black flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-2 border-red-500 border-t-transparent mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-400 mb-2\">Verifying admin access...</p>\r\n          {process.env.NODE_ENV === 'development' && (\r\n            <div className=\"text-xs text-gray-600 space-y-1\">\r\n              <p>Authenticated: {isAuthenticated ? 'Yes' : 'No'}</p>\r\n              <p>User: {user?.email || 'None'}</p>\r\n              <p>Is Admin: {user?.isAdmin ? 'Yes' : 'No'}</p>\r\n              {!isAuthenticated && (\r\n                <button \r\n                  onClick={() => router.push('/admin/login')} \r\n                  className=\"mt-2 text-red-400 underline text-xs\"\r\n                >\r\n                  Go to Admin Login\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-black\">\r\n      {children}\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS,gBAAgB,EACtC,QAAQ,EAGT;IACC,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,WAAW,IAAA,iJAAW;IAC5B,MAAM,EAAE,IAAI,EAAE,eAAe,EAAE,GAAG,IAAA,2HAAO;IACzC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IAEzC,oCAAoC;IACpC,IAAA,kNAAS,EAAC;QACR,YAAY;IACd,GAAG,EAAE;IAEL,0CAA0C;IAC1C,MAAM,mBAAmB;QAAC;KAAe;IACzC,MAAM,eAAe,iBAAiB,QAAQ,CAAC;IAE/C,IAAA,kNAAS,EAAC;QACR,+CAA+C;QAC/C,IAAI,CAAC,UAAU;QAEf,IAAI,YAAY;QAEhB,MAAM,mBAAmB;YACvB,IAAI,CAAC,WAAW;YAEhB,aAAa;YAEb,uEAAuE;YACvE,IAAI,cAAc;gBAChB,IAAI,WAAW;oBACb,gBAAgB;oBAChB,aAAa;gBACf;gBACA;YACF;YAEA,kCAAkC;YAClC,MAAM,QAAQ,sCAAgC,0BAAgC;YAE9E,wCAAY;gBACV,QAAQ,GAAG,CAAC;gBACZ;;gBAGA,OAAO,IAAI,CAAC;gBACZ;YACF;;;QAyCF;QAEA;QAEA,OAAO;YACL,YAAY;QACd;IACF,GAAG;QAAC;QAAU;QAAQ;QAAc;KAAS;IAE7C,2CAA2C;IAC3C,IAAI,aAAa,CAAC,cAAc;QAC9B,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;wBAAE,WAAU;kCAAqB;;;;;;oBACjC,oDAAyB,+BACxB,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;;oCAAE;oCAAgB,kBAAkB,QAAQ;;;;;;;0CAC7C,8OAAC;;oCAAE;oCAAO,MAAM,SAAS;;;;;;;0CACzB,8OAAC;;oCAAE;oCAAW,MAAM,UAAU,QAAQ;;;;;;;4BACrC,CAAC,iCACA,8OAAC;gCACC,SAAS,IAAM,OAAO,IAAI,CAAC;gCAC3B,WAAU;0CACX;;;;;;;;;;;;;;;;;;;;;;;IASf;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACZ;;;;;;AAGP"}}]
}