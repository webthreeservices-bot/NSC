"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4111],{14111:(e,r,t)=>{t.d(r,{A:()=>d});var o=t(12115),n=t(11498),s=t(31692);let a=(0,n.vt)()((0,s.Zr)(e=>({user:null,setUser:r=>e({user:r}),clearUser:()=>e({user:null})}),{name:"auth-storage"}));var i=t(22356),l=t(35082);function c(e){return{type:typeof e,constructor:e?.constructor?.name,message:e?.message,error:e?.error,response:e?.response?.data,status:e?.status||e?.response?.status,stack:e?.stack,raw:e}}function u(e){if(!e)return"An error occurred. Please try again.";let r=e.message||e.error||String(e);return r.includes("timeout")||r.includes("ETIMEDOUT")?"Connection timeout. Please check your internet and try again.":r.includes("network")||r.includes("fetch failed")?"Network error. Please check your connection and try again.":r.includes("ECONNREFUSED")||r.includes("connect")?"Cannot connect to server. Please try again later.":r.includes("database")||r.includes("Database")?"Service temporarily unavailable. Please try again in a moment.":r.includes("Invalid email or password")?"Invalid email or password":r.includes("blocked")?"Your account has been blocked. Please contact support.":r.includes("2FA")||r.includes("Too many")?r:r||"An error occurred. Please try again."}function d(){let{user:e,setUser:r,clearUser:t}=a(),[n,s]=(0,o.useState)(!1),[d,g]=(0,o.useState)(null),[f,h]=(0,o.useState)(!0),y=(0,o.useCallback)(async()=>{let e=(0,l.LJ)();if(!e)return console.log("\uD83D\uDD0D No token found, user not authenticated"),t(),h(!1),!1;try{console.log("\uD83D\uDD0D Validating existing token...");let o=await fetch("/api/auth/validate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},credentials:"include"});if(o.ok){let e=await o.json();if(e.valid&&e.user)return console.log("✅ Token valid, user authenticated:",e.user.email),r({id:e.user.id,email:e.user.email,username:e.user.email.split("@")[0],fullName:e.user.fullName||null,referralCode:e.user.referralCode||"",isAdmin:e.user.isAdmin||!1,isEmailVerified:e.user.isEmailVerified||!1,twoFactorEnabled:e.user.twoFactorEnabled||!1}),h(!1),!0}return console.log("❌ Token invalid, clearing authentication"),(0,l.Do)(),t(),h(!1),!1}catch(e){return console.error("❌ Token validation error:",e),(0,l.Do)(),t(),h(!1),!1}},[r,t]);(0,o.useEffect)(()=>{y()},[y]);let m=(0,o.useCallback)(async(e,t,o)=>{s(!0),g(null);try{let n=await i.R2.login({email:e,password:t,twoFactorCode:o});if(n?.success)return n.token&&((0,l.C$)(n.token),n.refreshToken&&(0,l.RX)(n.refreshToken)),n.user&&(r(n.user),n.user.isAdmin&&localStorage.setItem("adminToken",n.token)),{success:!0};if(n?.requires2FA)return g("Please enter your 2FA code"),{success:!1,error:"2FA code required"};return g("Login failed. Please try again."),{success:!1,error:"Login failed"}}catch(r){console.error("Login error in useAuth:",c(r));let e=u(r);if(e.includes("2FA"))return{success:!1,error:e};return g(e),{success:!1,error:e}}finally{s(!1)}},[r]);return{user:e,loading:n,error:d,initializing:f,login:m,register:(0,o.useCallback)(async e=>{s(!0),g(null);try{console.log("Registering with data:",e);let t=await i.R2.register(e);if(t?.token)return(0,l.C$)(t.token),t.user&&r(t.user),{success:!0};return{success:!1,error:t?.message||"Registration failed"}}catch(r){console.error("Registration error in useAuth:",c(r));let e=u(r);return g(e),{success:!1,error:e}}finally{s(!1)}},[r]),logout:(0,o.useCallback)(async()=>{(0,l.Do)(),t();try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){console.error("Logout error:",e)}window.location.href="/"},[t]),validateToken:y,setUser:r,isAuthenticated:!!e}}},22356:(e,r,t)=>{t.d(r,{AU:()=>l,Eo:()=>a,IM:()=>c,N_:()=>i,R2:()=>s,cD:()=>u,mf:()=>d});let o="/api";async function n(e,r={}){let{token:t,...s}=r,a={"Content-Type":"application/json",...s.headers};t&&(a.Authorization=`Bearer ${t}`);let i=null;for(let r=0;r<=2;r++)try{let t,n=new AbortController,i=setTimeout(()=>n.abort(),3e4),l=await fetch(`${o}${e}`,{...s,headers:a,signal:n.signal});clearTimeout(i);try{let e=await l.text();t=e?JSON.parse(e):{}}catch(e){console.error("Failed to parse response:",e),t={error:"Invalid response from server"}}if(!l.ok){let n={endpoint:e,status:l.status,statusText:l.statusText,data:t,attempt:r+1,url:`${o}${e}`};(n.status||n.data)&&console.error("API Error:",n);let s="Request failed";s=t&&"object"==typeof t?t.error&&"string"==typeof t.error?t.error:t.message&&"string"==typeof t.message?t.message:t.error&&"object"==typeof t.error?JSON.stringify(t.error):`Request failed with status ${l.status}`:"string"==typeof t?t:`Request failed with status ${l.status}`;let a=Error(s);throw a.status=l.status,a.data=t,a}return t}catch(t){if(i=t,("AbortError"===t.name||t.message?.includes("fetch")||t.message?.includes("network")||t.message?.includes("timeout")||t.message?.includes("ETIMEDOUT")||t.message?.includes("ECONNREFUSED"))&&r<2){console.warn(`Network error, retrying (${r+1}/2)...`),await new Promise(e=>setTimeout(e,1e3*Math.pow(2,r)));continue}if(console.error("API Request Error:",{endpoint:e,error:t.message||t,stack:t.stack,attempt:r+1}),t instanceof Error&&t.message)throw t;throw Error(t?.message||"Network error. Please check your connection and try again.")}throw i||Error("Request failed after retries")}let s={register:e=>n("/auth/register",{method:"POST",body:JSON.stringify(e)}),login:e=>n("/auth/login",{method:"POST",body:JSON.stringify(e)}),verifyEmail:e=>n("/auth/verify-email",{method:"POST",body:JSON.stringify({token:e})}),forgotPassword:e=>n("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:e})}),resetPassword:(e,r)=>n("/auth/reset-password",{method:"POST",body:JSON.stringify({token:e,newPassword:r})}),enable2FA:e=>n("/auth/enable-2fa",{method:"POST",token:e}),verify2FA:(e,r)=>n("/auth/verify-2fa",{method:"POST",body:JSON.stringify({code:e}),token:r})},a={getProfile:e=>n("/user/profile",{token:e}),updateProfile:(e,r)=>n("/user/profile",{method:"PUT",body:JSON.stringify(e),token:r}),getReferralCode:e=>n("/user/referral-code",{token:e})},i={create:(e,r)=>n("/packages/create",{method:"POST",body:JSON.stringify(e),token:r}),getMyPackages:(e,r)=>{let t=new URLSearchParams(e).toString();return n(`/packages/my-packages?${t}`,{token:r})},getPackageById:(e,r)=>n(`/packages/${e}`,{token:r}),verifyDeposit:(e,r,t)=>n(`/packages/${e}/verify-deposit`,{method:"POST",body:JSON.stringify({txHash:r}),token:t})},l={activate:(e,r)=>n("/bots/activate",{method:"POST",body:JSON.stringify(e),token:r}),getMyBots:e=>n("/bots/my-bots",{token:e}),checkEligibility:(e,r)=>n(`/bots/check-eligibility?botType=${e}`,{token:r})},c={getSummary:e=>n("/earnings/summary",{token:e}),getHistory:(e,r)=>{let t=new URLSearchParams(e).toString();return n(`/earnings/history?${t}`,{token:r})},getRoiSchedule:e=>n("/earnings/roi-schedule",{token:e})},u={getStats:e=>n("/referrals/stats",{token:e}),getTree:(e,r)=>{let t=e?`?level=${e}`:"";return n(`/referrals/tree${t}`,{token:r})},getDirect:e=>n("/referrals/direct",{token:e}),getLevelBreakdown:e=>n("/referrals/level-breakdown",{token:e})},d={request:(e,r)=>n("/withdrawals/request",{method:"POST",body:JSON.stringify(e),token:r}),getHistory:(e,r)=>{let t=new URLSearchParams(e).toString();return n(`/withdrawals/history?${t}`,{token:r})},checkEligibility:e=>n("/withdrawals/check-eligibility",{token:e})}},35082:(e,r,t)=>{function o(){try{let e=localStorage.getItem("token");if(!e&&(e=l("token")))try{localStorage.setItem("token",e),console.log("\uD83D\uDD04 Token synced from cookie to localStorage")}catch(e){console.warn("⚠️ Could not sync token to localStorage:",e)}return e?console.log("✅ Token found in storage"):console.log("❌ No token found in storage or cookies"),e}catch(e){return console.error("❌ Error getting token from storage:",e),l("token")}}function n(e){try{localStorage.setItem("token",e),c("token",e,7),console.log("✅ Token stored in localStorage and cookie")}catch(r){console.error("❌ Error storing token:",r);try{c("token",e,7),console.log("✅ Token stored in cookie only")}catch(e){console.error("❌ Failed to store token anywhere:",e)}}}function s(){try{localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),u("token"),u("refreshToken"),console.log("✅ All tokens cleared from storage and cookies")}catch(e){console.error("❌ Error clearing tokens:",e)}}function a(){try{let e=localStorage.getItem("refreshToken");if(!e&&(e=l("refreshToken")))try{localStorage.setItem("refreshToken",e)}catch(e){}return e}catch(e){return l("refreshToken")}}function i(e){try{localStorage.setItem("refreshToken",e),c("refreshToken",e,30)}catch(e){}}function l(e){if("undefined"==typeof document)return null;try{let r=`; ${document.cookie}`.split(`; ${e}=`);if(2===r.length){let e=r.pop();if(e)return e.split(";").shift()||null}return null}catch(e){return null}}function c(e,r,t){if("undefined"!=typeof document)try{let o=new Date;o.setTime(o.getTime()+24*t*36e5),document.cookie=`${e}=${r};expires=${o.toUTCString()};path=/;SameSite=Lax`}catch(e){console.error("Error setting cookie:",e)}}function u(e){if("undefined"!=typeof document)try{document.cookie=`${e}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`}catch(e){console.error("Error deleting cookie:",e)}}function d(){let e=o();if(!e)return null;try{let r=e.split(".");if(3!==r.length)return null;let t=r[1];if(!t)return null;let o=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(o).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch(e){return console.error("Error decoding token:",e),null}}t.d(r,{C$:()=>n,Do:()=>s,G:()=>a,LJ:()=>o,RX:()=>i,l4:()=>d})}}]);