"use strict";exports.id=6732,exports.ids=[6732],exports.modules={6732:(a,b,c)=>{c.d(b,{A:()=>l});var d=c(67484),e=c(81129),f=c(300);let g=(0,e.vt)()((0,f.Zr)(a=>({user:null,setUser:b=>a({user:b}),clearUser:()=>a({user:null})}),{name:"auth-storage"}));var h=c(95054),i=c(23518);function j(a){return{type:typeof a,constructor:a?.constructor?.name,message:a?.message,error:a?.error,response:a?.response?.data,status:a?.status||a?.response?.status,stack:a?.stack,raw:a}}function k(a){if(!a)return"An error occurred. Please try again.";let b=a.message||a.error||String(a);return b.includes("timeout")||b.includes("ETIMEDOUT")?"Connection timeout. Please check your internet and try again.":b.includes("network")||b.includes("fetch failed")?"Network error. Please check your connection and try again.":b.includes("ECONNREFUSED")||b.includes("connect")?"Cannot connect to server. Please try again later.":b.includes("database")||b.includes("Database")?"Service temporarily unavailable. Please try again in a moment.":b.includes("Invalid email or password")?"Invalid email or password":b.includes("blocked")?"Your account has been blocked. Please contact support.":b.includes("2FA")||b.includes("Too many")?b:b||"An error occurred. Please try again."}function l(){let{user:a,setUser:b,clearUser:c}=g(),[e,f]=(0,d.useState)(!1),[l,m]=(0,d.useState)(null),[n,o]=(0,d.useState)(!0),p=(0,d.useCallback)(async()=>{let a=(0,i.LJ)();if(!a)return console.log("\uD83D\uDD0D No token found, user not authenticated"),c(),o(!1),!1;try{console.log("\uD83D\uDD0D Validating existing token...");let d=await fetch("/api/auth/validate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},credentials:"include"});if(d.ok){let a=await d.json();if(a.valid&&a.user)return console.log("✅ Token valid, user authenticated:",a.user.email),b({id:a.user.id,email:a.user.email,username:a.user.email.split("@")[0],fullName:a.user.fullName||null,referralCode:a.user.referralCode||"",isAdmin:a.user.isAdmin||!1,isEmailVerified:a.user.isEmailVerified||!1,twoFactorEnabled:a.user.twoFactorEnabled||!1}),o(!1),!0}return console.log("❌ Token invalid, clearing authentication"),(0,i.Do)(),c(),o(!1),!1}catch(a){return console.error("❌ Token validation error:",a),(0,i.Do)(),c(),o(!1),!1}},[b,c]),q=(0,d.useCallback)(async(a,c,d)=>{f(!0),m(null);try{let e=await h.R2.login({email:a,password:c,twoFactorCode:d});if(e?.success)return e.token&&((0,i.C$)(e.token),e.refreshToken&&(0,i.RX)(e.refreshToken)),e.user&&(b(e.user),e.user.isAdmin&&localStorage.setItem("adminToken",e.token)),{success:!0};if(e?.requires2FA)return m("Please enter your 2FA code"),{success:!1,error:"2FA code required"};return m("Login failed. Please try again."),{success:!1,error:"Login failed"}}catch(b){console.error("Login error in useAuth:",j(b));let a=k(b);if(a.includes("2FA"))return{success:!1,error:a};return m(a),{success:!1,error:a}}finally{f(!1)}},[b]);return{user:a,loading:e,error:l,initializing:n,login:q,register:(0,d.useCallback)(async a=>{f(!0),m(null);try{console.log("Registering with data:",a);let c=await h.R2.register(a);if(c?.token)return(0,i.C$)(c.token),c.user&&b(c.user),{success:!0};return{success:!1,error:c?.message||"Registration failed"}}catch(b){console.error("Registration error in useAuth:",j(b));let a=k(b);return m(a),{success:!1,error:a}}finally{f(!1)}},[b]),logout:(0,d.useCallback)(async()=>{(0,i.Do)(),c();try{await fetch("/api/auth/logout",{method:"POST"})}catch(a){console.error("Logout error:",a)}window.location.href="/"},[c]),validateToken:p,setUser:b,isAuthenticated:!!a}}},95054:(a,b,c)=>{c.d(b,{AU:()=>i,Eo:()=>g,IM:()=>j,N_:()=>h,R2:()=>f,cD:()=>k,mf:()=>l});let d="/api";async function e(a,b={}){let{token:c,...f}=b,g={"Content-Type":"application/json",...f.headers};c&&(g.Authorization=`Bearer ${c}`);let h=null;for(let b=0;b<=2;b++)try{let c,e=new AbortController,h=setTimeout(()=>e.abort(),3e4),i=await fetch(`${d}${a}`,{...f,headers:g,signal:e.signal});clearTimeout(h);try{let a=await i.text();c=a?JSON.parse(a):{}}catch(a){console.error("Failed to parse response:",a),c={error:"Invalid response from server"}}if(!i.ok){let e={endpoint:a,status:i.status,statusText:i.statusText,data:c,attempt:b+1,url:`${d}${a}`};(e.status||e.data)&&console.error("API Error:",e);let f="Request failed";f=c&&"object"==typeof c?c.error&&"string"==typeof c.error?c.error:c.message&&"string"==typeof c.message?c.message:c.error&&"object"==typeof c.error?JSON.stringify(c.error):`Request failed with status ${i.status}`:"string"==typeof c?c:`Request failed with status ${i.status}`;let g=Error(f);throw g.status=i.status,g.data=c,g}return c}catch(c){if(h=c,("AbortError"===c.name||c.message?.includes("fetch")||c.message?.includes("network")||c.message?.includes("timeout")||c.message?.includes("ETIMEDOUT")||c.message?.includes("ECONNREFUSED"))&&b<2){console.warn(`Network error, retrying (${b+1}/2)...`),await new Promise(a=>setTimeout(a,1e3*Math.pow(2,b)));continue}if(console.error("API Request Error:",{endpoint:a,error:c.message||c,stack:c.stack,attempt:b+1}),c instanceof Error&&c.message)throw c;throw Error(c?.message||"Network error. Please check your connection and try again.")}throw h||Error("Request failed after retries")}let f={register:a=>e("/auth/register",{method:"POST",body:JSON.stringify(a)}),login:a=>e("/auth/login",{method:"POST",body:JSON.stringify(a)}),verifyEmail:a=>e("/auth/verify-email",{method:"POST",body:JSON.stringify({token:a})}),forgotPassword:a=>e("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:a})}),resetPassword:(a,b)=>e("/auth/reset-password",{method:"POST",body:JSON.stringify({token:a,newPassword:b})}),enable2FA:a=>e("/auth/enable-2fa",{method:"POST",token:a}),verify2FA:(a,b)=>e("/auth/verify-2fa",{method:"POST",body:JSON.stringify({code:a}),token:b})},g={getProfile:a=>e("/user/profile",{token:a}),updateProfile:(a,b)=>e("/user/profile",{method:"PUT",body:JSON.stringify(a),token:b}),getReferralCode:a=>e("/user/referral-code",{token:a})},h={create:(a,b)=>e("/packages/create",{method:"POST",body:JSON.stringify(a),token:b}),getMyPackages:(a,b)=>{let c=new URLSearchParams(a).toString();return e(`/packages/my-packages?${c}`,{token:b})},getPackageById:(a,b)=>e(`/packages/${a}`,{token:b}),verifyDeposit:(a,b,c)=>e(`/packages/${a}/verify-deposit`,{method:"POST",body:JSON.stringify({txHash:b}),token:c})},i={activate:(a,b)=>e("/bots/activate",{method:"POST",body:JSON.stringify(a),token:b}),getMyBots:a=>e("/bots/my-bots",{token:a}),checkEligibility:(a,b)=>e(`/bots/check-eligibility?botType=${a}`,{token:b})},j={getSummary:a=>e("/earnings/summary",{token:a}),getHistory:(a,b)=>{let c=new URLSearchParams(a).toString();return e(`/earnings/history?${c}`,{token:b})},getRoiSchedule:a=>e("/earnings/roi-schedule",{token:a})},k={getStats:a=>e("/referrals/stats",{token:a}),getTree:(a,b)=>{let c=a?`?level=${a}`:"";return e(`/referrals/tree${c}`,{token:b})},getDirect:a=>e("/referrals/direct",{token:a}),getLevelBreakdown:a=>e("/referrals/level-breakdown",{token:a})},l={request:(a,b)=>e("/withdrawals/request",{method:"POST",body:JSON.stringify(a),token:b}),getHistory:(a,b)=>{let c=new URLSearchParams(a).toString();return e(`/withdrawals/history?${c}`,{token:b})},checkEligibility:a=>e("/withdrawals/check-eligibility",{token:a})}}};